<!DOCTYPE html>
<html>
<head>
    <title>StarForge Validation Test</title>
    <script type="text/javascript" src="js/model/StarForgeModel.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .fail { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>StarForge Validation Test Results</h1>
    <div id="test-results"></div>

    <script>
        function runTests() {
            const results = [];
            
            // Test 1: Default configuration should be valid
            console.log("=== Test 1: Default Configuration ===");
            const model1 = new StarForgeModel();
            const result1 = model1.validateForgeGraph();
            console.log("Default configuration valid:", result1);
            results.push({
                name: "Test 1: Default Configuration",
                expected: true,
                actual: result1,
                pass: result1 === true
            });

            // Test 2: Create an invalid configuration where pipes don't connect properly
            console.log("\n=== Test 2: Invalid Configuration - Disconnected Pipe ===");
            const model2 = new StarForgeModel();
            // Clear the default setup
            for(let i = 0; i < model2.modules.length; i++) {
                model2.modules[i].type = StarForgeModel.TYPE_EMPTY;
            }

            // Set up: INPUT -> PIPE_UD (wrong orientation) -> FORGE -> PIPE_LR -> OUTPUT
            // This should fail because PIPE_UD can't connect left-right
            model2.modules[0] = {type: StarForgeModel.TYPE_INPUT};     // (0,0)
            model2.modules[1] = {type: StarForgeModel.TYPE_PIPE_UD};   // (1,0) - wrong orientation!
            model2.modules[2] = {type: StarForgeModel.TYPE_FORGE};     // (2,0)
            model2.modules[3] = {type: StarForgeModel.TYPE_PIPE_LR};   // (3,0)
            model2.modules[4] = {type: StarForgeModel.TYPE_OUTPUT};    // (4,0)

            const result2 = model2.validateForgeGraph();
            console.log("Invalid configuration (wrong pipe orientation) valid:", result2);
            results.push({
                name: "Test 2: Invalid Configuration - Wrong Pipe Orientation",
                expected: false,
                actual: result2,
                pass: result2 === false
            });

            // Test 3: Valid alternative configuration
            console.log("\n=== Test 3: Valid Alternative Configuration ===");
            const model3 = new StarForgeModel();
            // Clear the default setup
            for(let i = 0; i < model3.modules.length; i++) {
                model3.modules[i].type = StarForgeModel.TYPE_EMPTY;
            }

            // Set up: INPUT -> PIPE_LR -> FORGE -> PIPE_LR -> OUTPUT (all horizontal)
            model3.modules[0] = {type: StarForgeModel.TYPE_INPUT};     // (0,0)
            model3.modules[1] = {type: StarForgeModel.TYPE_PIPE_LR};   // (1,0)
            model3.modules[2] = {type: StarForgeModel.TYPE_FORGE};     // (2,0)
            model3.modules[3] = {type: StarForgeModel.TYPE_PIPE_LR};   // (3,0)
            model3.modules[4] = {type: StarForgeModel.TYPE_OUTPUT};    // (4,0)

            const result3 = model3.validateForgeGraph();
            console.log("Valid alternative configuration valid:", result3);
            results.push({
                name: "Test 3: Valid Alternative Configuration",
                expected: true,
                actual: result3,
                pass: result3 === true
            });

            // Test 4: Configuration with no path from forge to output
            console.log("\n=== Test 4: No Path to Output ===");
            const model4 = new StarForgeModel();
            // Clear the default setup
            for(let i = 0; i < model4.modules.length; i++) {
                model4.modules[i].type = StarForgeModel.TYPE_EMPTY;
            }

            // Set up: INPUT -> PIPE_LR -> FORGE, OUTPUT isolated
            model4.modules[0] = {type: StarForgeModel.TYPE_INPUT};     // (0,0)
            model4.modules[1] = {type: StarForgeModel.TYPE_PIPE_LR};   // (1,0)
            model4.modules[2] = {type: StarForgeModel.TYPE_FORGE};     // (2,0)
            model4.modules[5] = {type: StarForgeModel.TYPE_OUTPUT};    // (5,0) - isolated

            const result4 = model4.validateForgeGraph();
            console.log("No path to output valid:", result4);
            results.push({
                name: "Test 4: No Path to Output",
                expected: false,
                actual: result4,
                pass: result4 === false
            });

            // Display results
            displayResults(results);
        }

        function displayResults(results) {
            const container = document.getElementById('test-results');
            let allPassed = true;

            results.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-section`;
                
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${result.pass ? 'pass' : 'fail'}`;
                resultDiv.innerHTML = `
                    <strong>${result.name}</strong><br>
                    Expected: ${result.expected}<br>
                    Actual: ${result.actual}<br>
                    Result: ${result.pass ? 'PASS' : 'FAIL'}
                `;
                
                div.appendChild(resultDiv);
                container.appendChild(div);
                
                if (!result.pass) allPassed = false;
            });

            // Summary
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-section`;
            summaryDiv.innerHTML = `
                <h2>Summary</h2>
                <div class="test-result ${allPassed ? 'pass' : 'fail'}">
                    <strong>Overall Result: ${allPassed ? 'ALL TESTS PASSED' : 'SOME TESTS FAILED'}</strong><br>
                    Passed: ${results.filter(r => r.pass).length}/${results.length}
                </div>
            `;
            container.appendChild(summaryDiv);

            console.log("\n=== Summary ===");
            results.forEach(result => {
                console.log(`${result.name}: ${result.pass ? 'PASS' : 'FAIL'}`);
            });
            console.log(`Overall: ${allPassed ? 'ALL TESTS PASSED' : 'SOME TESTS FAILED'}`);
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>